# ============================================================
# ML 票房預測 Pipeline 配置檔案
# ============================================================
# 用途：統一管理所有腳本的參數，避免打長長的命令列
# 使用方式：
#   1. 在下方找到要執行的腳本，把enabled 改為 true
#   2. 填寫該腳本的參數
#   3. 執行：uv run scripts/run_pipeline.py config/pipeline_config.yaml      <<<<< 關鍵指令!!! >>>>>
# ============================================================

# ------------------------------------------------------------
# 累積特徵 (add_cumsum_features.py)
# ------------------------------------------------------------
add_cumsum_features:
  enabled: true
  # 欲新增<累計特徵欄位>的 csv
  input_file: ""   # 留空會自動從 data/ML_boxoffice/phase1_flattened 找日期最新的檔案
  # 輸出位置
  output_file: ""  # 留空會自動輸出到 data/ML_boxoffice/phase2_features/with_cumsum
  description: "生成累積特徵（截至上週）- 會自動找最新的 phase1 檔案並輸出到 with_cumsum"



# ------------------------------------------------------------
# 市場特徵 (add_market_features.py)
# ------------------------------------------------------------
############# 待修復 ############# 
# input file、output file皆須指定
# 請先打指令  uv run src/ML_boxoffice/phase2_features/add_cumsum_features.py ^ data\ML_boxoffice\phase1_flattened\boxoffice_timeseries_2025-11-06.csv ^ data\ML_boxoffice\phase2_features\with_cumsum\features_cumsum_2025-11-07.csv
################################## 
add_market_features:
  enabled: false
  # 欲新增<市場特徵欄位>的 csv
  input_file: ""        # 留空會自動從 data/ML_boxoffice/phase1_flattened 找日期最新的檔案
  # input_file: "data/ML_boxoffice/phase2_features/with_cumsum/features_cumsum_2025-11-06.csv"

  # 電影資訊檔案
  movie_info_file: ""   # 留空會自動從 data/processed/movieInfo_gov/combined 找日期最新的檔案
  # 輸出位置
  output_file: ""       # 留空會自動輸出到 data/ML_boxoffice/phase2_features/with_market
  description: "生成市場特徵（票價、年份、月份、地區、發行商、分級、片長）- 會自動找最新的 phase1 檔案"



# ------------------------------------------------------------
# 資料過濾 (filter_data.py)
# ------------------------------------------------------------
filter_data:
  enabled: false
  # 欲刪減的 csv (必填)
  input_file: "data/ML_boxoffice/phase2_features/with_cumsum/features_cumsum_2025-11-06.csv"

  # 要刪除的欄位（取消註解即啟用刪除）
  # 注意：gov_id, round_idx, official_release_date, week_range 等基本欄位不建議刪除
  drop_columns:
    # === 1. 基本資訊 (不建議刪除) ===
    # - "gov_id"              # 電影唯一識別碼（絕對不可刪）
    # - "round_idx"             # 輪次編號
    - "rounds_cumsum"           # 累計輪次數
    # - "official_release_date" # 正式上映日期
    # - "week_range"            # 週次時間範圍

    # === 2. 當週時間資訊 ===
    # - "current_week_real_idx"    # 當輪真實週次
    # - "current_week_active_idx"  # 當輪活躍週次
    # - "gap_real_week_2to1"       # week_-2到week_-1跳過的週次數
    # - "gap_real_week_1tocurrent" # week_-1到當週跳過的週次數

    # === 3. 近期趨勢（前兩週資料）===
    # - "boxoffice_week_2"      # 兩週前票房
    # - "boxoffice_week_1"      # 上週票房（重要特徵，不建議刪）
    # - "boxoffice_week_1_PR"   # 上週票房百分位排名                            --- 尚未建置 ---
    # - "audience_week_2"       # 兩週前觀影人數
    # - "audience_week_1"       # 上週觀影人數
    # - "audience_week_1_PR"    # 上週觀影人數百分位排名                        --- 尚未建置 ---
    # - "screens_week_2"        # 兩週前院線數
    # - "screens_week_1"        # 上週院線數
    # - "screens_week_1_PR"     # 上週院線數百分位排名                          --- 尚未建置 ---

    # === 4. 累積資訊（截至上週）===
    # - "boxoffice_cumsum"                # 跨輪累積票房
    # - "boxoffice_round1_cumsum"         # 首輪累積票房
    # - "boxoffice_current_round_cumsum"  # 當輪累積票房
    # - "audience_cumsum"                 # 跨輪累積觀影人數
    # - "audience_round1_cumsum"          # 首輪累積觀影人數
    # - "audience_current_round_cumsum"   # 當輪累積觀影人數

    # === 5. 開片實力（固定指首輪）===
    # - "open_week1_days"                 # 首輪第1週上映天數
    # - "open_week1_boxoffice"            # 首輪第1週票房
    # - "open_week1_boxoffice_daily_avg"  # 首輪第1週日均票房（重要特徵，不建議刪）
    # - "open_week1_boxoffice_daily_avg_PR" # 首週日均票房百分位排名            --- 尚未建置 ---
    # - "open_week2_boxoffice"            # 首輪第2週票房

    # === 6. 市場資訊 ===
    - "ticket_price_avg_current" # 當年度平均票價（依輪次區分） ps. 目前數值異常，建議刪掉
    # - "release_year"             # 首輪上映年份
    # - "release_month"            # 首輪上映月份
    # - "region"                   # 發行地區    **目前為中文字串
    # - "publisher"                # 發行商名稱  **目前為中文字串
    # - "is_restricted"            # 是否為限制級(Fasle:0 / True:1)
    # - "film_length"              # 片長（分鐘）

    # === 9. 當周資訊 ===
    # NOTE: 訓練前要全部刪掉，否則會有「洩漏資料」的問題
    # - "amount"                  # 當周票房
    # - "audience"                # 當周觀影人次
    - "theater_count"             # 當周放映場次數

    # === 8. 目標變數（絕對不可刪）===
    # - "target_boxoffice"         # 當週票房（預測目標，絕對不可刪）

  # 要保留的輪次
  keep_rounds:                                 # 留空則保留全部
    - 1
    # - 2
    # - 3
    # - 4
    # - 5 
  # 是否刪除無輪內活躍編號的 row
  drop_null_active_week: true
  # 輸出位置
  output_file: ""                              # 留空則自動生成帶時間戳記的檔名
  # 剔除電影清單
  exclude_config: "config/exclude_movies.csv"  # 留空則使用預設
  # 備註說明
  description: "過濾資料：只保留第1輪，刪除指定欄位和無活躍編號的row"



# ------------------------------------------------------------
# 未來可以新增其他腳本
# ------------------------------------------------------------
# some_other_script:
#   enabled: false
#   input_file: "..."
#   output_file: "..."
#   param1: value1
#   param2: value2
