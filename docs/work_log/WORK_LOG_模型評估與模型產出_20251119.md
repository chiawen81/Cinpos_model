# 模型評估與模型產出

> **版本**: 1.0
> **建立日期**: 2025-11-19
> **最後更新**: 2025-11-29
> **用途**: 記錄模型評估方法、產出格式與結果分析

**返回**: [工作日誌主頁](../WORK_LOG.md)

---

## 📋 目錄

- [評估方法](#評估方法)
- [評估指標](#評估指標)
- [模型產出格式](#模型產出格式)
- [評估結果記錄](#評估結果記錄)
- [問題與改進](#問題與改進)

---

## 🎯 評估方法

### 資料切分策略

#### 時間切分（主要方法）
```
訓練集: 2020-2023 年度資料
驗證集: 2024 年度資料
測試集: 2025 年度資料
```

**優點**:
- 符合實際預測情境（用過去預測未來）
- 避免資料洩漏

**缺點**:
- 資料量較少時可能不夠穩定

#### K-Fold 交叉驗證（輔助方法）
```
K = 5
分組方式: 按電影分組（避免同一電影出現在訓練和測試集）
```

### 評估流程

1. **訓練階段**
   - 在訓練集上訓練模型
   - 在驗證集上調整超參數
   - 記錄訓練過程（loss, metrics）

2. **測試階段**
   - 在測試集上評估最終模型
   - 產出預測結果檔案
   - 計算各項評估指標

3. **分析階段**
   - 誤差分析（按輪次、週次、電影類型）
   - 視覺化預測結果
   - 識別表現異常的案例

---

## 📊 評估指標

### 主要指標

#### 1. MAPE (Mean Absolute Percentage Error)
```python
MAPE = mean(|實際值 - 預測值| / 實際值) × 100%
```
- **目標**: 首輪 < 25%, 次輪 < 35%
- **優點**: 百分比形式，易於理解
- **缺點**: 實際值接近 0 時不穩定

#### 2. RMSE (Root Mean Square Error)
```python
RMSE = sqrt(mean((實際值 - 預測值)²))
```
- **目標**: < 350 萬
- **優點**: 對大誤差敏感
- **單位**: 元（新台幣）

#### 3. MAE (Mean Absolute Error)
```python
MAE = mean(|實際值 - 預測值|)
```
- **優點**: 對離群值不敏感
- **單位**: 元（新台幣）

### 輔助指標

- **R² (決定係數)**: 衡量模型解釋變異的能力
- **中位數絕對誤差**: 更穩健的誤差衡量
- **分位數誤差**: 評估極端值預測表現

---

## 📦 模型產出格式

### 1. 模型檔案
```
phase4_models/M1_predict_boxoffice/
├── model_YYYY-MM-DD.pkl          # 訓練好的模型
├── feature_importance.csv         # 特徵重要性
└── model_config.json             # 模型配置參數
```

### 2. 預測結果
```
phase4_models/M1_predict_boxoffice/
└── predictions_YYYY-MM-DD.csv    # 預測結果
```

**欄位說明**:
| 欄位名稱 | 類型 | 說明 |
|---------|------|------|
| gov_id | string | 電影識別碼 |
| round_idx | integer | 輪次編號 |
| current_week_real_idx | integer | 當週真實週次 |
| actual_boxoffice | float | 實際票房 |
| predicted_boxoffice | float | 預測票房 |
| absolute_error | float | 絕對誤差 |
| percentage_error | float | 百分比誤差 |

### 3. 評估報告
```
phase4_models/M1_predict_boxoffice/
└── evaluation_YYYY-MM-DD.json    # 評估指標
```

**內容範例**:
```json
{
  "model_name": "XGBoost_v1",
  "train_date": "2025-11-19",
  "overall_metrics": {
    "MAPE": 28.5,
    "RMSE": 325.7,
    "MAE": 245.3,
    "R2": 0.78
  },
  "round1_metrics": {
    "MAPE": 22.3,
    "RMSE": 298.4,
    "sample_count": 850
  },
  "round2_metrics": {
    "MAPE": 31.8,
    "RMSE": 156.2,
    "sample_count": 420
  }
}
```

---

## 📈 評估結果記錄

### [日期] - [模型版本]

**模型配置**:
- 演算法:
- 特徵數:
- 訓練樣本數:

**整體表現**:
| 指標 | 數值 | 是否達標 |
|------|------|----------|
| MAPE | - | ☐ 是 ☐ 否 |
| RMSE | - | ☐ 是 ☐ 否 |
| MAE | - | - |

**分輪次表現**:
| 輪次 | MAPE | RMSE | 樣本數 |
|------|------|------|--------|
| 首輪 | - | - | - |
| 次輪 | - | - | - |

**觀察與分析**:
-

---

## 🐛 問題與改進

### 已識別問題

#### 問題 #1: [問題描述]
- **影響範圍**:
- **可能原因**:
- **改進方向**:
- **優先級**: ☐ 高 ☐ 中 ☐ 低

### 改進方向

1. **短期改進**
   - [ ] 待補充

2. **中期改進**
   - [ ] 待補充

3. **長期改進**
   - [ ] 待補充

---

## 📚 相關文件

- [模型規格](../spec_model.md)
- [資料字典](../model/data_資料欄位定義.md)
- [票房預測模型優化流程](./WORK_LOG_票房預測模型優化流程.md)
- [模型優化進度](./WORK_LOG_模型優化進度.md)
